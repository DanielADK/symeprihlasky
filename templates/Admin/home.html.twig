{# /src/templates/Admin/home.html.twig #}
{% extends "Admin/base.html.twig" %}
{% block title %}E-Přihlášky - Administrace{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{{ asset('adminlte/bower_components/fullcalendar/dist/fullcalendar.min.css') }}">
    <style>
        .fc .fc-content .fc-title {
            display: inline-block;
            padding: 4px 6px;
            font-size: larger;
            white-space: normal;
        }
    </style>
{% endblock %}
{% block content %}
    <section class="content-wrapper">
        {% include "Admin/Modules/page_path_list.html.twig" %}

        <!-- Main content -->
        <main class="content container-fluid">
            <div class="alert alert-danger" style="display:none;" role="alert" id="failedSubmit">
                <b>Ajaj! </b> Nepodařilo se stáhnout data do kalendáře.
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="row">
                <div class="col-lg-7 col-md-9 col-sm-12">
                    <div class="box box-primary">
                        <div class="box-body">
                            <div id="calendar" class="fc fc-ltr">
                                <div id="calendar-overlay">
                                    <i id="calendar-overlay-spinner" class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-3 col-sm-12">
                    <div class="box box-solid">
                        <div class="box-header with-border">
                            <h4 class="box-title">Legenda</h4>
                        </div>
                        <div class="box-body legenda">
                            <h3 class="legenda-item"><span class="label label-primary"><i class="fa fa-map-o"></i> Jednodenní akce</span></h3>
                            <h3 class="legenda-item"><span class="label label-danger"><i class="fa fa-map-signs"></i> Vícedenní akce</span></h3>
                            <h3 class="legenda-item"><span class="label label-success"><i class="fa fa-fire"></i> Letní tábor</span></h3>
                            <h3 class="legenda-item"><span class="label label-warning"><i class="fa fa-beer"></i> Dospělácká akce</span></h3>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </section>
{% endblock %}
{% block javascripts %}
    <script src="{{ asset("adminlte/bower_components/fullcalendar/dist/fullcalendar.min.js") }}"></script>
    <script src="{{ asset("adminlte/bower_components/fullcalendar/dist/locale/cs.js") }}"></script>
    <script>

        $(function () {
            var date = new Date();
            var d    = date.getDate(),
                m    = date.getMonth(),
                y    = date.getFullYear()

            var calendar = new FullCalendar.Calendar($("#calendar"), {
                plugins: ['bootstrap', 'dayGrid'],
                themeSystem: 'bootstrap3',
                initialView: 'dayGridMonth',
                weekNumbers: true,
                displayEventTime: false,
                locale: 'cs',
                selectable: true,
                header: {
                    left: 'title',
                    right: 'prev,today,next'
                },
                loading:
                    function (isLoading) {
                        if (isLoading)
                            $('#calendar-overlay').show();
                        else
                            $('#calendar-overlay').hide();
                    },
                events:
                    function(start, end, timezone, callback) {
                    $.ajax({
                        url: "/api/events?dateStart[after]=" +
                            start.format("YYYY-MM-DD 00:00:01") +
                            "&dateEnd[before]=" +
                            end.format("YYYY-MM-DD 00:00:01"),
                        type: "GET",
                    error: function(jqXHR, textStatus, errorThrown) {
                        customPopUpMin($("#failSubmit"));
                    },
                    success: function(jsondata){

                        var parseddata = [];
                        jsondata.forEach(event => {
                            let single = {};

                            single.id = event.id;
                            single.title = event.fullName;
                            single.start = event.dateStart;
                            single.end = new Date(event.dateEnd);
                            single.end.setDate(single.end.getDate()+1);
                            single.url = "/admin/akce/zobrazit/" + event.id;
                            single.display = "block"

                            switch (event.type) {
                                case "JA":
                                    single.backgroundColor = "#3c8dbc";
                                    single.borderColor = "#3c8dbc";
                                    break;
                                case "VA":
                                    single.backgroundColor = "#dd4b39";
                                    single.borderColor = "#dd4b39";
                                    break;
                                case "LT":
                                    single.backgroundColor = "#00a65a";
                                    single.borderColor = "#00a65a";
                                    break;
                                case "PV":
                                    single.backgroundColor = "#f39c12";
                                    single.borderColor = "#f39c12";
                                    break;
                                default:
                                    single.backgroundColor = "#23527c"
                                    single.borderColor = "#23527c";
                                    break;
                            }
                            parseddata.push(single);
                        });
                        callback(parseddata);
                    },
                    dataType: "json"
                });
                },
            });

            calendar.render();
        });
    </script>
{% endblock %}